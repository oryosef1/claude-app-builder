FROM node:18-alpine

WORKDIR /app

# Copy package files
COPY api/package*.json ./api/
COPY dashboard/package*.json ./dashboard/

# Install dependencies
RUN cd api && npm install
RUN cd dashboard && npm install

# Copy source code
COPY api/ ./api/
COPY dashboard/ ./dashboard/

# Set working directory to API for testing
WORKDIR /app/api

# Run tests
CMD ["npm", "test"]